<!DOCTYPE html>
<html>
<head>
    <title></title>
    <!--<script src="http://code.createjs.com/createjs-2013.09.25.min.js"></script>-->
    <script src="lib/createjs-2013.09.25.min.js"></script>
    <script>
        var stage;
        var queue;

        var manifest = [
            /*{id : "sound_ringtone", src : "content/perfect_ringtone.mp3"},
            {id : "sound_thunder", src : "content/thunder.ogg"},*/
            {id : "image_pizza", src : "content/pizza_64.png"},
            {id : "image_poo", src : "content/poo_64.gif"}
        ]

        /*!
         * Initializes and loads resources.
         */
        function init() {
            stage = new createjs.Stage("gameCanvas");

            /* Take into account "Mobile Safe Approach":
             http://www.createjs.com/Docs/SoundJS/classes/Sound.html
             */
            createjs.Sound.registerPlugins([createjs.WebAudioPlugin, createjs.FlashPlugin, createjs.HTMLAudioPlugin]);
            /* We provide here 20 channels instead of the default value 2,
               because users can surely touch more than 2 times in very small time duration.
               When we will use sound with smaller duration for destroy - we can probably remove this line.
            */
            createjs.Sound.registerSound("content/thunder.ogg", "sound_thunder", 20);
            queue = new createjs.LoadQueue(false);
            queue.installPlugin(createjs.Sound);
            queue.addEventListener("complete", handleLoadComplete);
            queue.loadManifest(manifest);
        }

        var objects = [
            {id : 1, type : 'image_pizza', delayTimeMillis : 200, availableMillis : 3000, from : {x : 0, y : 150}, to : {x : 800, y : 300}},
            {id : 2, type : 'image_poo', delayTimeMillis : 700, availableMillis : 3500, from : {x : 100, y : 0}, to : {x : 800, y : 200}},
            {id : 3, type : 'image_poo', delayTimeMillis : 1000, availableMillis : 4000, from : {x : 300, y : 0}, to : {x : 800, y : 600}},
            {id : 4, type : 'image_pizza', delayTimeMillis : 2100, availableMillis : 3500, from : {x : 800, y : 50}, to : {x : 200, y : 600}},
            {id : 5, type : 'image_poo', delayTimeMillis : 2000, availableMillis : 2700, from : {x : 800, y : 40}, to : {x : 0, y : 550}},
            {id : 6, type : 'image_pizza', delayTimeMillis : 3000, availableMillis : 2900, from : {x : 500, y : 0}, to : {x : 0, y : 600}}
        ]

        /*!
         * Initializes game board, prepares all objects.
         * Will be called right after all resources will be loaded.
         *
         * @param event   resource loaded complete event
         */
        function handleLoadComplete(event) {
            for(var i in objects) {
                var obj = objects[i];
                console.log("Initialization of object, id=" + obj.id);

                var object = new createjs.Bitmap(queue.getResult(obj.type));
                var from_ = adjustBorderlineCoordinate(obj.from);
                object.x = from_.x;
                object.y = from_.y;
                object.on("click", handleObjectTouched, null, true, object);

                var to_ = adjustBorderlineCoordinate(obj.to);
                createjs.Tween.get(object).wait(obj.delayTimeMillis).to({x : to_.x, y : to_.y}, obj.availableMillis);

                stage.addChild(object);
            }
            createjs.Ticker.addEventListener("tick", updateStage);
        }

        var IMAGE_SIZE = 64;

        function adjustBorderlineCoordinate(point) {
            if (point.x == 0) {
                point.x -= IMAGE_SIZE;
            } else {
                point.x += IMAGE_SIZE/2;
            }
            if (point.y == 0) {
                point.y -= IMAGE_SIZE;
            } else {
                point.y += IMAGE_SIZE/2;
            }
            return point
        }

        /*!
         * Destroys clicked/touched object.
         *
         * @param event   object clicked/touched event
         * @param object   the object
         */
        function handleObjectTouched(event, object) {
            stage.removeChild(object);
            var instance = createjs.Sound.play("sound_thunder");
            instance.volume = 0.5;
        }

        function updateStage(event) {
            stage.update();
        }

    </script>
</head>
<body onload="init()">
<canvas id="gameCanvas" width="800" height="600">
    Your browser does not support canvas
</canvas>
</body>
</html>
